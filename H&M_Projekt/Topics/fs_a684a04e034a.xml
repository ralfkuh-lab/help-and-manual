<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" modified="2026-01-30T13:12:52.052Z" lasteditedby="rakul" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>Programmiermöglichkeiten in Transportkontrollskripten</title>
  <body>
    <header>
      <para styleclass="Heading1">Programmiermöglichkeiten in Transportkontrollskripten</para>
    </header>
    <para styleclass="Normal">Sie können in Transportkontrollskripten sämtliche Möglichkeiten nutzen, die Custom Code in IKAROS bietet, da die Skripte im Zielsystem von IKAROS selbst ausgeführt werden.</para>
    <para styleclass="ÜberschriftEinfach">Einschränkungen</para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Aufzählung1" style="font-family:Symbol; font-size:10pt; color:#000000;">
      <li styleclass="Aufzählung1">Benutzerinteraktion (u. a. Anzeige von Dialogen oder Abfragen) ist innerhalb des Skripts nicht möglich.</li>
      <li styleclass="Aufzählung1">Es ist nicht möglich, den Inhalt des aktuellen Artefaktpakets per Programmierung generisch abzufragen oder zu verändern. Beim Entwickeln eines Transportkontrollskripts müssen Sie daher wissen, welche Artefakte im Paket enthalten sein werden, falls Sie z. B. Vergleiche im Zielsystem vornehmen möchten.</li>
      <li styleclass="Aufzählung1">Die Skripte werden im IKAROS-Zielsystem ausgeführt. Falls Sie in den Skripten auf externe Programme zugreifen (z. B. CMD-Befehle ausführen) oder externe Dateien schreiben/auslesen, müssen Sie sicherstellen, dass alle potenziellen IKAROS-Zielsysteme die entsprechenden Zugriffe erlauben.</li>
    </list>
    <para styleclass="ÜberschriftEinfach">Ergebnisse der Transportkontrollskripte im Transportprotokoll</para>
    <para styleclass="Normal">Meldungen, die mittels der Transportkontrollskripte in das Transportprotokoll geschrieben wurden, stehen im TRMS-Protokoll in einem eigenen Knoten „Transportkontrollskripte“:</para>
    <para styleclass="Verknüpfung" style="tabstops:95px left ;"><image src="_HelpPlusManual_TRMS_img150.png" scale="56.00%" styleclass="Normal" figurelistinclude="0"></image></para>
    <para styleclass="caption">Abb. 44: Ergebnisse des Finalisierungs-Skripts im Transport-Protokoll</para>
    <para styleclass="ÜberschriftEinfach_Gross">Verwendung von LINQ</para>
    <para styleclass="Normal"><text styleclass="Editionshinweis">Hinweis: In IKAROS basic/starter kann LINQ nicht verwendet werden.</text></para>
    <para styleclass="Normal">Häufig werden Sie LINQ benötigen, um z. B. abzufragen, ob bestimmte Stammdaten im Zielsystem schon vorhanden sind (bzw. mit welchem Änderungsstand).</para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Aufzählung1" style="font-family:Symbol; font-size:10pt; color:#000000;">
      <li styleclass="Aufzählung1">Custom Code bietet für viele, allerdings nicht alle, möglichen Artefakt-Typen bereits eigene Objekte an. Dann können Sie per LINQ direkt Objekte ermitteln. Beispielsweise für Aktenvorgangsvorlagen:</li>
    </list>
    <para styleclass="Quellcode_Eingerückt_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">const eventTemplate = linq.execute(&apos;from e in @EventTemplate where e.eventCode === &quot;Z001&quot; select e&apos;).singleOrDefault();</para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Aufzählung1" style="font-family:Symbol; font-size:10pt; color:#000000;">
      <li styleclass="Aufzählung1">Per LINQ können Sie auch andere Stammdaten abfragen, für die es in IKAROS keine Objekte gibt. Dann müssen Sie sich allerdings in LINQ per „new“-Anweisung typenlose Objekte zusammenstellen und diese zurückliefern lassen:</li>
    </list>
    <para styleclass="Quellcode_Eingerückt_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">const ccAppToTransport = {<br/> &#160; designation: &apos;Erfolgsstatistik&apos;,<br/> &#160; nameSpace: &apos;Fs&apos;,<br/> &#160; versionNo: 1<br/>};<br/><br/>const allCcApps = linq.execute(&apos;from app in @CustomApp select&apos; +<br/> &#160; &apos; new { designation = app.designation, nameSpace = app.nameSpace, versionNo = app.versionNo, ID = app.customCode.Id, cvId = app.CvId }&apos;).toList();<br/><br/>if (allCcApps.some(app =&gt; app.designation === ccAppToTransport.designation &amp;&amp;<br/> &#160; &#160; &#160;app.nameSpace === ccAppToTransport.nameSpace &amp;&amp;<br/> &#160; &#160; &#160;app.versionNo === ccAppToTransport.versionNo)) {<br/><br/> &#160; trms.reportInfo(&apos;Custom Code app &quot;&apos; + ccAppToTransport.nameSpace + &apos;.&apos; + ccAppToTransport.designation + &apos;&quot; already in target system.&apos;);<br/>}</para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Aufzählung1" style="font-family:Symbol; font-size:10pt; color:#000000;">
      <li styleclass="Aufzählung1">Oder Sie können die Suche nach den Stammdaten direkt in die LINQ-Abfrage integrieren:</li>
    </list>
    <para styleclass="Quellcode_Eingerückt_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">const ccAppToTransport = {<br/> &#160; designation: &apos;Erfolgsstatistik&apos;,<br/> &#160; nameSpace: &apos;Fs&apos;,<br/> &#160; versionNo: 1<br/>};<br/><br/>const appExists = linq.execute(`from app in @CustomApp where app.designation === &quot;${ccAppToTransport.designation}&quot; &amp;&amp; <br/> &#160; app.nameSpace === &quot;${ccAppToTransport.nameSpace}&quot; &amp;&amp; <br/> &#160; app.versionNo.toString() === &quot;${ccAppToTransport.versionNo}&quot;<br/> &#160; select app.id`).any();<br/><br/>if (appExists) {<br/> &#160; trms.reportInfo(&apos;Custom Code app &quot;&apos; + ccAppToTransport.nameSpace + &apos;.&apos; + ccAppToTransport.designation + &apos;&quot; already in target system.&apos;);<br/>}</para>
    <para styleclass="ÜberschriftEinfach_Gross">TRMS-spezifische Zugriffe</para>
    <para styleclass="Normal">Nur in Code, der als Transportkontrollskript ausgeführt wird, können Sie die Zugriffe des „Trms“-Objekts nutzen:</para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Aufzählung1" style="font-family:Symbol; font-size:10pt; color:#000000;">
      <li styleclass="Aufzählung1">„<text styleclass="Strong">trms.reportInfo()</text>“: Schreibt „Information“-Einträge ins Transportprotokoll.</li>
      <li styleclass="Aufzählung1">„<text styleclass="Strong">trms.reportError()</text>“: Schreibt einerseits „Fehler“-Einträge ins Transportprotokoll. Andererseits bewirkt die Methode in Prerequisite- und Initialisierungs-Skripten, dass &#160;kein einziges Artefakt aus der transportierten Paketdatei im Zielsystem installiert wird. Die Skriptausführung wird trotz solcher Fehler fortgesetzt, sodass Sie auch mehrere solcher Fehler protokollieren können. Allerdings führt schon der erste Aufruf dazu, dass bei einem tatsächlichen Transport aus dem TRMS kein Artefakt in das Zielsystem eingespielt würde.</li>
      <li styleclass="Aufzählung1">„<text styleclass="Strong">Trms.transportSuccessful</text>“: Liefert einen logischen Wert, ob alle Artefakte erfolgreich transportiert wurden (true), oder ob bei mindestens einem im Zielsystem ein Fehler aufgetreten ist (false).</li>
    </list>
    <para styleclass="ÜberschriftEinfach">Speziell verfügbare globale Variablen</para>
    <para styleclass="Normal" style="margin-left:8px;"><table rowcount="2" colcount="2" style="width:auto; cell-padding:6px; cell-spacing:0px; page-break-inside:auto; border-width:0px; border-spacing:0px; border-collapse:collapse; cell-border-width:1px; border-color:#a6a6a6; border-style:solid; background-color:none; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:top; width:55px;">
          <para styleclass="Normal" style="text-align:center; page-break-after:avoid;"><text style="font-weight:bold; color:#ffffff;">Variable</text></para>
        </td>
        <td style="vertical-align:top; width:511px;">
          <para styleclass="Normal" style="text-align:center; page-break-after:avoid;"><text style="font-weight:bold; color:#ffffff;">Beschreibung</text></para>
        </td>
      </tr>
      <tr style="vertical-align:top">
        <td style="vertical-align:top; width:55px;">
          <para styleclass="Normal"><text style="font-size:9pt;">trms</text></para>
        </td>
        <td style="vertical-align:top; width:511px;">
          <para styleclass="Normal"><text style="font-size:9pt;">Das „trms“-Objekt ist nur nutzbar, wenn der Code als Transportkontrollskript ausgeführt wird. Nur dann haben Sie auch Zugriff auf dessen Methoden zum Schreiben von Einträgen in das Transportprotokoll.</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="ÜberschriftEinfach">Tipp: TRMS-Skripte in IKAROS lauffähig machen</para>
    <para styleclass="Normal">Die Nutzung der Zugriffe am „trms“-Objekt führen in IKAROS zu einem Fehler, wenn der Code nicht als Transportkontrollskript ausführt wird. Um ein Skript dennoch in IKAROS selbst entwickeln und testen zu können, bietet der Editor-Dialog im TRMS die Schaltflächen „<text styleclass="Strong">Code für IKAROS kopieren</text>“ und „<text styleclass="Strong">Code von IKAROS einfügen</text>“ an.</para>
    <para styleclass="Normal">Wenn Sie den Code aus dem Editor durch Klick auf „Code für IKAROS kopieren“ in die Zwischenablage kopieren (es muss mindestens ein Zeichen im Editor stehen), reichert das TRMS Ihren Code automatisch mit generischem Custom Code an, der den gesamten Code im JavaScript-Editor von IKAROS lauffähig macht.</para>
    <para styleclass="Normal">Dieser Code wird am Anfang Ihres Codes eingefügt:</para>
    <para styleclass="Quellcode_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">(() =&gt; {class Trms {<br/> &#160; &#160;constructor() {<br/> &#160; &#160; &#160; &#160;/** @type {{type: &quot;E&quot; | &quot;M&quot;, message: string}[]} */<br/> &#160; &#160; &#160; &#160;this.messages = [];<br/> &#160; &#160;}<br/> &#160; &#160;/**<br/> &#160; &#160; * @param {(trms: Trms) =&gt; boolean | void} callback<br/> &#160; &#160; */<br/> &#160; &#160;runScript(callback) {<br/> &#160; &#160; &#160;callback(this);<br/> &#160; &#160; &#160; &#160;let result = &apos;S&apos;; <br/> &#160; &#160; &#160; &#160;if (this.messages.some(x =&gt; x.type === &apos;E&apos;))<br/> &#160; &#160; &#160; &#160; &#160; &#160;result = &apos;E&apos;;<br/> &#160; &#160; &#160; &#160;return JSON.stringify({<br/> &#160; &#160; &#160; &#160; &#160; &#160;result: result,<br/> &#160; &#160; &#160; &#160; &#160; &#160;messages: this.messages<br/> &#160; &#160; &#160; &#160;});<br/> &#160; &#160;}<br/> &#160; &#160;/**<br/> &#160; &#160; * @param {string} message<br/> &#160; &#160; */<br/> &#160; &#160;reportError(message) {<br/> &#160; &#160; &#160; &#160;this.messages.push({ type: &apos;E&apos;, message });<br/> &#160; &#160;}<br/> &#160; &#160;/**<br/> &#160; &#160; * @param {string} message<br/> &#160; &#160; */<br/> &#160; &#160;reportInfo(message) {<br/> &#160; &#160; &#160; &#160;this.messages.push({ type: &apos;M&apos;, message });<br/> &#160; &#160;}<br/>}<br/>return new Trms().runScript(trms =&gt; {<br/> &#160; <text styleclass="Strong">// Code des eigentlichen Transportkontrollskripts</text><br/> &#160; &#160;<br/> &#160; &#160;<br/>});<br/>})();</para>
    <para styleclass="ÜberschriftEinfach">Rückgabe-Objekt mit den Meldungen</para>
    <para styleclass="Normal">Bei Ausführung gibt dieser Code ein Objekt zurück, das einen Buchstaben für das Ausführungsergebnis sowie ein Array von Objekten enthält, welche die protokollierten Meldungen repräsentieren:</para>
    <para styleclass="Quellcode_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">{<br/> &#160; result: &quot;S&quot;, // &quot;S&quot; = success, &quot;E&quot; = error<br/> &#160; messages: [{<br/> &#160; &#160; &#160;type: &quot;M&quot;,<br/> &#160; &#160; &#160;message: &quot;Text einer Infomeldung ...&quot;<br/> &#160; }, {<br/> &#160; &#160; &#160;type: &quot;E&quot;,<br/> &#160; &#160; &#160;message: &quot;Text einer Fehlermeldung ...&quot;<br/> &#160; }]<br/>}</para>
    <para styleclass="Normal">Nach der Entwicklung in IKAROS müssen Sie den Code im Ganzen kopieren und dann im TRMS per Schaltfläche „Code von IKAROS einfügen“ einfügen. Dabei wird der zuvor angereicherte Code automatisch wieder entfernt.</para>
    <para styleclass="ÜberschriftEinfach_Gross">Beispiel</para>
    <para styleclass="Normal">In dem folgenden einfachen Beispiel wird per LINQ geprüft, ob im Zielsystem eine Aktenvorgangsvorlage „Z001“ existiert und ob entsprechende Vorgänge bereits in Akten angelegt wurden:</para>
    <para styleclass="Quellcode_OhneFarbe" style="tabstops:19px left,38px left,57px left,76px left,95px left,113px left,132px left,151px left,170px left,189px left ;">const eventTemplateCode = &apos;Z001&apos;;<br/>const targetEnvironmentInfo =<br/> &#160; fs.getSetting(&apos;SCHEME_VERSION&apos;) + &apos; (&apos; + fs.getSetting(&apos;IKAROS-Umgebung&apos;) + &apos;)&apos;;<br/>const eventTemplate =<br/> &#160; linq.execute(`from e in @EventTemplate where <br/> &#160; e.eventCode === &quot;${eventTemplateCode}&quot; select e`).singleOrDefault();<br/>if (eventTemplate !== null) {<br/><br/> &#160; trms.reportInfo(&apos;Event template &quot;&apos; + eventTemplateCode + &apos;&quot; with last change date &apos; +<br/> &#160; &#160; &#160;eventTemplate.lastUpdate.toLocaleShortDateString() + &apos; exists in the target environment &apos; +<br/> &#160; &#160; &#160;targetEnvironmentInfo + &apos;).&apos;);<br/><br/> &#160; if (linq.execute(`from e in @Event <br/> &#160; &#160; &#160;where e.EventTemplate.eventCode === &quot;${eventTemplateCode}&quot; select e`).any()) {<br/><br/> &#160; &#160; &#160;trms.reportInfo(&apos;Actual &quot;&apos; + eventTemplateCode + &apos;&quot; events in cases found.&apos;);<br/> &#160; } else {<br/> &#160; &#160; &#160;trms.reportError(&apos;No &quot;&apos; + eventTemplateCode + &apos;&quot; events not found in any IKAROS case!&apos;);<br/> &#160; }<br/>} else {<br/> &#160; trms.reportError(&apos;Event template &quot;&apos; + eventTemplateCode +<br/> &#160; &#160; &#160;&apos;&quot; does not exist in the target environment &apos; + targetEnvironmentInfo + &apos;).&apos;);<br/>}</para>
  </body>
</topic>
