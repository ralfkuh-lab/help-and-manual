<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Programmiermöglichkeiten in Transportkontrollskripten</title>
<meta charset="utf-8" /><link rel="stylesheet" type="text/css" href="../LinksExt/TRMS.css" />
<script src="../js/nethelp.redirector.js" type="text/javascript"></script>
<link rel="prev" href="fs_11ed2b9082ce.html" /><link rel="next" href="fs_3361362778f0.html" />
<meta name="Generator" content="Doc-To-Help v.6.0.0.7152" />
</head>
<body data-c1-topic-id="36a16fc9-973e-44c0-aade-6b54d16df6e3">
<h2 style="tab-stops: 0pt">Programmiermöglichkeiten in 
Transportkontrollskripten</h2>
<p class="MsoNormal">Sie können in Transportkontrollskripten sämtliche 
Möglichkeiten nutzen, die Custom Code in IKAROS bietet, da die Skripte im 
Zielsystem von IKAROS selbst ausgeführt werden.</p>
<p class="berschriftEinfach">Einschränkungen</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Benutzerinteraktion (u. a. Anzeige von 
Dialogen oder Abfragen) ist innerhalb des Skripts nicht möglich.</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Es ist nicht möglich, den Inhalt des 
aktuellen Artefaktpakets per Programmierung generisch abzufragen oder zu 
verändern. Beim Entwickeln eines Transportkontrollskripts müssen Sie daher 
wissen, welche Artefakte im Paket enthalten sein werden, falls Sie z. B. 
Vergleiche im Zielsystem vornehmen möchten.</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Die Skripte werden im IKAROS-Zielsystem 
ausgeführt. Falls Sie in den Skripten auf externe Programme zugreifen (z. B. 
CMD-Befehle ausführen) oder externe Dateien schreiben/auslesen, müssen Sie 
sicherstellen, dass alle potenziellen IKAROS-Zielsysteme die entsprechenden 
Zugriffe erlauben.</p>
<p class="berschriftEinfach">Ergebnisse der Transportkontrollskripte im 
Transportprotokoll</p>
<p class="MsoNormal">Meldungen, die mittels der Transportkontrollskripte in das 
Transportprotokoll geschrieben wurden, stehen im TRMS-Protokoll in einem eigenen 
Knoten „Transportkontrollskripte“:</p>
<p class="Verknpfung"><img src="../ImagesExt/image10_93.png" alt="" /></p>
<p class="MsoCaption">Abb. 44: Ergebnisse des Finalisierungs-Skripts im 
Transport-Protokoll</p>
<div style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 1pt; PADDING-TOP: 0pt; PADDING-LEFT: 0pt; BORDER-LEFT: medium none; MARGIN: 9pt 14.2pt 3pt 0pt; PADDING-RIGHT: 0pt">
<p class="berschriftEinfachGross" style="MARGIN-BOTTOM: 0pt; MARGIN-TOP: 0pt">Verwendung von LINQ</p></div>
<p class="MsoNormal"><span class="Editionshinweis"><span style="FONT-SIZE: 9pt; COLOR: black">Hinweis: In IKAROS basic/starter kann LINQ 
nicht verwendet werden.</span></span><span class="Editionshinweis"><span style="FONT-SIZE: 9pt"></span></span></p>
<p class="MsoNormal">Häufig werden Sie LINQ benötigen, um z. B. abzufragen, ob 
bestimmte Stammdaten im Zielsystem schon vorhanden sind (bzw. mit welchem 
Änderungsstand).</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Custom Code bietet für viele, allerdings 
nicht alle, möglichen Artefakt-Typen bereits eigene Objekte an. Dann können Sie 
per LINQ direkt Objekte ermitteln. Beispielsweise für Aktenvorgangsvorlagen:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 4pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt 17.7pt; PADDING-RIGHT: 4pt">
<p class="QuellcodeEingercktOhneFarbe" style="MARGIN: 0pt">const eventTemplate = 
linq.execute('from e in @EventTemplate where e.eventCode === "Z001" select 
e').singleOrDefault();</p></div>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Per LINQ können Sie auch andere 
Stammdaten abfragen, für die es in IKAROS keine Objekte gibt. Dann müssen Sie 
sich allerdings in LINQ per „new“-Anweisung typenlose Objekte zusammenstellen 
und diese zurückliefern lassen:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 4pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt 17.7pt; PADDING-RIGHT: 4pt">
<p class="QuellcodeEingercktOhneFarbe" style="MARGIN: 0pt">const ccAppToTransport 
= {<br />   designation: 'Erfolgsstatistik',<br />   nameSpace: 
'Fs',<br />   versionNo: 1<br />};<br /><br />const allCcApps = 
linq.execute('from app in @CustomApp select' +<br />   ' new { 
designation = app.designation, nameSpace = app.nameSpace, versionNo = 
app.versionNo, ID = app.customCode.Id, cvId = app.CvId }').toList();<br /><br />if 
(allCcApps.some(app =&gt; app.designation === ccAppToTransport.designation 
&amp;&amp;<br />      app.nameSpace === 
ccAppToTransport.nameSpace &amp;&amp;<br />      
app.versionNo === ccAppToTransport.versionNo)) {<br /><br />   
trms.reportInfo('Custom Code app "' + ccAppToTransport.nameSpace + '.' + 
ccAppToTransport.designation + '" already in target system.');<br />}</p></div>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  Oder Sie können die Suche nach den 
Stammdaten direkt in die LINQ-Abfrage integrieren:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 4pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt 17.7pt; PADDING-RIGHT: 4pt">
<p class="QuellcodeEingercktOhneFarbe" style="MARGIN: 0pt">const ccAppToTransport 
= {<br />   designation: 'Erfolgsstatistik',<br />   nameSpace: 
'Fs',<br />   versionNo: 1<br />};<br /><br />const appExists = 
linq.execute(`from app in @CustomApp where app.designation === 
"${ccAppToTransport.designation}" &amp;&amp; <br />   app.nameSpace === 
"${ccAppToTransport.nameSpace}" &amp;&amp; <br />   
app.versionNo.toString() === "${ccAppToTransport.versionNo}"<br />   
select app.id`).any();<br /><br />if (appExists) {<br />   
trms.reportInfo('Custom Code app "' + ccAppToTransport.nameSpace + '.' + 
ccAppToTransport.designation + '" already in target system.');<br />}</p></div>
<div style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 1pt; PADDING-TOP: 0pt; PADDING-LEFT: 0pt; BORDER-LEFT: medium none; MARGIN: 9pt 14.2pt 3pt 0pt; PADDING-RIGHT: 0pt">
<p class="berschriftEinfachGross" style="MARGIN-BOTTOM: 0pt; MARGIN-TOP: 0pt">TRMS-spezifische Zugriffe</p></div>
<p class="MsoNormal">Nur in Code, der als Transportkontrollskript ausgeführt wird, 
können Sie die Zugriffe des „Trms“-Objekts nutzen:</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  „<strong><span style="FONT-FAMILY: &quot;Segoe UI&quot;,sans-serif">trms.reportInfo()</span></strong>“: 
Schreibt „Information“-Einträge ins Transportprotokoll.</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  „<strong><span style="FONT-FAMILY: &quot;Segoe UI&quot;,sans-serif">trms.reportError()</span></strong>“: 
Schreibt einerseits „Fehler“-Einträge ins Transportprotokoll. Andererseits 
bewirkt die Methode in Prerequisite- und Initialisierungs-Skripten, dass  
kein einziges Artefakt aus der transportierten Paketdatei im Zielsystem 
installiert wird. Die Skriptausführung wird trotz solcher Fehler fortgesetzt, 
sodass Sie auch mehrere solcher Fehler protokollieren können. Allerdings führt 
schon der erste Aufruf dazu, dass bei einem tatsächlichen Transport aus dem TRMS 
kein Artefakt in das Zielsystem eingespielt würde.</p>
<p class="Aufzhlung1" style="tab-stops: 17.85pt"><img src="../ImagesExt/image10_1.png" alt="" />  „<strong><span style="FONT-FAMILY: &quot;Segoe UI&quot;,sans-serif">Trms.transportSuccessful</span></strong>“: 
Liefert einen logischen Wert, ob alle Artefakte erfolgreich transportiert wurden 
(true), oder ob bei mindestens einem im Zielsystem ein Fehler aufgetreten ist 
(false).</p>
<p class="berschriftEinfach">Speziell verfügbare globale Variablen</p>
<table class="TabelleKopfOben" style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-COLLAPSE: collapse; BORDER-BOTTOM: medium none; MARGIN-LEFT: 5.65pt; BORDER-LEFT: medium none" cellspacing="0" cellpadding="0" border="1">
  <thead>
  <tr>
    <td style="BORDER-TOP: gray 1pt solid; BORDER-RIGHT: gray 1pt solid; BACKGROUND: #4f81bd; BORDER-BOTTOM: gray 1pt solid; PADDING-BOTTOM: 2.85pt; PADDING-TOP: 2.85pt; PADDING-LEFT: 5.4pt; BORDER-LEFT: gray 1pt solid; PADDING-RIGHT: 5.4pt" valign="top">
      <p class="MsoNormal" style="TEXT-ALIGN: center" align="center"><b><span style="COLOR: white">Variable</span></b></p></td>
    <td style="BORDER-TOP: gray 1pt solid; BORDER-RIGHT: gray 1pt solid; BACKGROUND: #4f81bd; BORDER-BOTTOM: gray 1pt solid; PADDING-BOTTOM: 2.85pt; PADDING-TOP: 2.85pt; PADDING-LEFT: 5.4pt; BORDER-LEFT: medium none; PADDING-RIGHT: 5.4pt" valign="top">
      <p class="MsoNormal" style="TEXT-ALIGN: center" align="center"><b><span style="COLOR: white">Beschreibung</span></b></p></td></tr></thead>
  <tbody>
  <tr>
    <td style="BORDER-TOP: medium none; BORDER-RIGHT: #a6a6a6 1pt solid; BORDER-BOTTOM: #a6a6a6 1pt solid; PADDING-BOTTOM: 2.85pt; PADDING-TOP: 2.85pt; PADDING-LEFT: 5.4pt; BORDER-LEFT: #a6a6a6 1pt solid; PADDING-RIGHT: 5.4pt" valign="top">
      <p class="MsoNormal">trms</p></td>
    <td style="BORDER-TOP: medium none; BORDER-RIGHT: #a6a6a6 1pt solid; BORDER-BOTTOM: #a6a6a6 1pt solid; PADDING-BOTTOM: 2.85pt; PADDING-TOP: 2.85pt; PADDING-LEFT: 5.4pt; BORDER-LEFT: medium none; PADDING-RIGHT: 5.4pt" valign="top">
      <p class="MsoNormal">Das „trms“-Objekt ist nur nutzbar, wenn der Code als 
      Transportkontrollskript ausgeführt wird. Nur dann haben Sie auch Zugriff 
      auf dessen Methoden zum Schreiben von Einträgen in das 
      Transportprotokoll.</p></td></tr></tbody></table>
<p class="berschriftEinfach">Tipp: TRMS-Skripte in IKAROS lauffähig machen</p>
<p class="MsoNormal">Die Nutzung der Zugriffe am „trms“-Objekt führen in IKAROS zu 
einem Fehler, wenn der Code nicht als Transportkontrollskript ausführt wird. Um 
ein Skript dennoch in IKAROS selbst entwickeln und testen zu können, bietet der 
Editor-Dialog im TRMS die Schaltflächen „<strong><span style="FONT-FAMILY: &quot;Segoe UI&quot;,sans-serif">Code für IKAROS 
kopieren</span></strong>“ und „<strong><span style="FONT-FAMILY: &quot;Segoe UI&quot;,sans-serif">Code von IKAROS 
einfügen</span></strong>“ an.</p>
<p class="MsoNormal">Wenn Sie den Code aus dem Editor durch Klick auf „Code für 
IKAROS kopieren“ in die Zwischenablage kopieren (es muss mindestens ein Zeichen 
im Editor stehen), reichert das TRMS Ihren Code automatisch mit generischem 
Custom Code an, der den gesamten Code im JavaScript-Editor von IKAROS lauffähig 
macht.</p>
<p class="MsoNormal">Dieser Code wird am Anfang Ihres Codes eingefügt:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 6pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt -1.3pt; PADDING-RIGHT: 6pt">
<p class="QuellcodeOhneFarbe" style="MARGIN: 0pt">(() =&gt; {class Trms 
{<br />    constructor() 
{<br />        /** @type {{type: "E" | "M", 
message: string}[]} */<br />        
this.messages = [];<br />    }<br />    
/**<br />     * @param {(trms: Trms) =&gt; boolean | void} 
callback<br />     */<br />    
runScript(callback) {<br />      
callback(this);<br />        let result = 'S'; 
<br />        if (this.messages.some(x =&gt; 
x.type === 
'E'))<br />            
result = 'E';<br />        return 
JSON.stringify({<br />            
result: 
result,<br />            
messages: this.messages<br />        
});<br />    }<br />    
/**<br />     * @param {string} 
message<br />     */<br />    
reportError(message) {<br />        
this.messages.push({ type: 'E', message });<br />    
}<br />    /**<br />     * @param {string} 
message<br />     */<br />    reportInfo(message) 
{<br />        this.messages.push({ type: 'M', 
message });<br />    }<br />}<br />return new Trms().runScript(trms 
=&gt; {<br />   <strong><span style="FONT-FAMILY: &quot;Courier New&quot;">// Code 
des eigentlichen Transportkontrollskripts<br /></span></strong>    
<br />    <br />});<br />})();</p></div>
<p class="berschriftEinfach">Rückgabe-Objekt mit den Meldungen</p>
<p class="MsoNormal">Bei Ausführung gibt dieser Code ein Objekt zurück, das einen 
Buchstaben für das Ausführungsergebnis sowie ein Array von Objekten enthält, 
welche die protokollierten Meldungen repräsentieren:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 6pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt -1.3pt; PADDING-RIGHT: 6pt">
<p class="QuellcodeOhneFarbe" style="MARGIN: 0pt">{<br />   result: "S", 
// "S" = success, "E" = error<br />   messages: 
[{<br />      type: 
"M",<br />      message: "Text einer Infomeldung 
..."<br />   }, {<br />      type: 
"E",<br />      message: "Text einer Fehlermeldung 
..."<br />   }]<br />}</p></div>
<p class="MsoNormal">Nach der Entwicklung in IKAROS müssen Sie den Code im Ganzen 
kopieren und dann im TRMS per Schaltfläche „Code von IKAROS einfügen“ einfügen. 
Dabei wird der zuvor angereicherte Code automatisch wieder entfernt.</p>
<div style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 1pt; PADDING-TOP: 0pt; PADDING-LEFT: 0pt; BORDER-LEFT: medium none; MARGIN: 9pt 14.2pt 3pt 0pt; PADDING-RIGHT: 0pt">
<p class="berschriftEinfachGross" style="MARGIN-BOTTOM: 0pt; MARGIN-TOP: 0pt">Beispiel</p></div>
<p class="MsoNormal">In dem folgenden einfachen Beispiel wird per LINQ geprüft, ob 
im Zielsystem eine Aktenvorgangsvorlage „Z001“ existiert und ob entsprechende 
Vorgänge bereits in Akten angelegt wurden:</p>
<div style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 6pt; PADDING-TOP: 6pt; PADDING-LEFT: 6pt; BORDER-LEFT: windowtext 1pt solid; MARGIN: 3pt 5.65pt 3pt -1.3pt; PADDING-RIGHT: 6pt">
<p class="QuellcodeOhneFarbe" style="MARGIN: 0pt">const eventTemplateCode = 
'Z001';<br />const targetEnvironmentInfo =<br />   
fs.getSetting('SCHEME_VERSION') + ' (' + fs.getSetting('IKAROS-Umgebung') + 
')';<br />const eventTemplate =<br />   linq.execute(`from e in 
@EventTemplate where <br />   e.eventCode === "${eventTemplateCode}" 
select e`).singleOrDefault();<br />if (eventTemplate !== null) 
{<br /><br />   trms.reportInfo('Event template "' + eventTemplateCode + 
'" with last change date ' +<br />      
eventTemplate.lastUpdate.toLocaleShortDateString() + ' exists in the target 
environment ' +<br />      targetEnvironmentInfo + 
').');<br /><br />   if (linq.execute(`from e in @Event 
<br />      where e.EventTemplate.eventCode === 
"${eventTemplateCode}" select e`).any()) {<br /><br />      
trms.reportInfo('Actual "' + eventTemplateCode + '" events in cases 
found.');<br />   } else {<br />      
trms.reportError('No "' + eventTemplateCode + '" events not found in any IKAROS 
case!');<br />   }<br />} else {<br />   trms.reportError('Event 
template "' + eventTemplateCode +<br />      '" does not 
exist in the target environment ' + targetEnvironmentInfo + 
').');<br />}</p></div>
<div class="related-topics-header">
<hr size="1" noshade="" />

<p class="MsoBodyText">Themen:</p>
<div class="related-topics">
<p class="MsoNormal"><a class="topic-link" style="TEXT-DECORATION: none" href="fs_3361362778f0.html">Beispiel für ein Prerequisite-Skript zum Prüfen von 
Datenschutz-Zwecken</a></p></div></div></body></html>
